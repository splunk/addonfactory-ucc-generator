# Dashboard

UCC introduces a support for a dashboard page, which is available from v5.27.0.
The dashboard page configuration is generated if the `ucc-gen init` command is used.
The dashboard page is optional, you can delete it from configuration if you
don't need it in your add-on.

The dashboard page provides some additional information about the add-on
operations to increase the visibility into what the add-on is actually doing
under the hood.

As of now, 3 pre-built panels are supported:

* Add-on version
* Events ingested by sourcetype
* Errors in the add-on.

> Note: if you change the dashboard page using the Edit button after the add-on is
> installed, the changes go to the `local` folder. You will see your version
> of the dashboard even if you update an add-on.

To be able to add a dashboard page to an existing add-on, you need to adjust your 
globalConfig file and include a new "dashboard" page there. See the following example:

```json
{
    "pages": {
        "configuration": {
            "tabs": [
                ...
            ],
            "title": "Configuration",
            "description": "Set up your add-on"
        },
        "inputs": {
            "services": [
                ...
            ],
            "title": "Inputs",
            "description": "Manage your data inputs",
            "table": {
                ...
            }
        },
        "dashboard": {
            "panels": [
                {
                    "name": "addon_version"
                },
                {
                    "name": "events_ingested_by_sourcetype"
                },
                {
                    "name": "errors_in_the_addon"
                }
            ]
        }
    },
    "meta": {
      ...
    }
}
```

### Add-on version

Executes the following search:

```
| rest services/apps/local/<addon_name> splunk_server=local | fields version
```

> Note: <addon_name> is being replaced by the actual value during the build time.

### Events ingested by sourcetype

Execute the following search:

```
index=_internal source=*<addon_name>* action=events_ingested
| timechart sum(n_events) by sourcetype_ingested
```

> Note: <addon_name> is replaced by the actual value during the build time.

This search assumes specific data format in the internal logs to fill the panel with
data.

It's recommended to utilize `solnlib.log`'s [`events_ingested` function](https://github.com/splunk/addonfactory-solutions-library-python/blob/3045f9d15398fac0bd6740645ba119250ead129b/solnlib/log.py#L253).

### Errors in the add-on

Execute the following search:

```
index=_internal source=*<addon_name>* ERROR
```

> Note: <addon_name> is being replaced by the actual value during the build time.

<br>
# Custom components

UCC also supports adding your own components to the dashboard. 
To do this, create a **dashboard_components.xml** file in the add-on's root directory (at the same level as globalConfig.json). 
The correct structure of this file is a root tag called **custom-dashboard**, with child elements called **row**. Any other child tags will break the build process.
Inside the **row** tags you can specify your **panels**. 

For more information about xml structure and element hierarchy, [see](https://docs.splunk.com/Documentation/Splunk/latest/Viz/PanelreferenceforSimplifiedXML#panel).


NOTE: This autogenerated dashboard also supports the dynamic setting of the data range `<input type="time" token="log_time">`. If you want to use a dynamic data range in your panels, you must reference the `log_time` token.<br>

```xml
          <earliest>$log_time.earliest$</earliest>
          <latest>$log_time.latest$</latest>
```
<br>

**dashboard_components.xml** location:
```

<TA>
 ├── package
 ...
 ├── dashboard_components.xml
 ├── globalConfig.json
 ...
```

sample **dashboard_components.xml** structure:
```xml
<custom-dashboard>
    <row>
        <panel>
            <title>MY PANEL IN ROW 1</title>
            <chart>
                <search>
                    <query>index=_internal
                    </query>
                    <earliest>0</earliest>
                    <latest>now</latest>
                </search>
            </chart>
        </panel>
        <panel>
            <title>MY SECOND PANEL IN ROW 1</title>
            <chart>
                <search>
                    <query>index=_internal</query>
                    <earliest>-14d@d</earliest>
                    <latest></latest>
                    <sampleRatio>1</sampleRatio>
                </search>
            </chart>
        </panel>
    </row>
    <row>
        <panel>
            <title>MY PANEL IN ROW 2</title>
            <chart>
                <search>
                    <query>index=_internal</query>
                    <earliest>$log_time.earliest$</earliest>
                    <latest>$log_time.latest$</latest>
                </search>
            </chart>
        </panel>
    </row>
</custom-dashboard>
```

Next, you have to add the **custom** panel to your dashboard page in globalConfig.json. 
The order of panels in the globalConfig corresponds to the order of rows on the dashboard.

```json
{
...
        "dashboard": {
            "panels": [
                {
                    "name": "addon_version"
                },
                {
                    "name": "events_ingested_by_sourcetype"
                },
                {
                    "name": "errors_in_the_addon"
                },
                {
                    "name": "custom"
                }
            ]
        }
...
}
```
