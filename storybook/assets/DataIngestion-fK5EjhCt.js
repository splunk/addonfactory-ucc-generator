import{j as a}from"./jsx-runtime-1FKYbnEZ.js";import{r as o,R as Q}from"./index-prPvd6Su.js";import{r as L,d as V,E as F,a as T}from"./EnterpriseViewOnlyPreset-CGUmpnD9.js";import{S as U}from"./Search-DHvjbgMH.js";import{M as W}from"./Message-Bh14h08T.js";import{l as G}from"./messageUtil-CvmCOD_s.js";import{T as Y}from"./DashboardPage.stories-eFNQleTo.js";import{m as K,c as X,b as Z,l as ee,g as O,q as te,f as ae,d as oe,e as se,h as ne}from"./utils-DVPTqGYn.js";import{M as q}from"./Modal-BOe57yII.js";import{q as I}from"./omit-UcH284-_.js";import{v as k}from"./variables-BJ06o7R7.js";import{B as N}from"./Button-B_-pY_Ng.js";import{M as A,D as re}from"./Menu-D7dHzYG8.js";import{g as P}from"./_commonjsHelpers-CE1G-McA.js";import{a as ie}from"./Menu-D4-b3kko.js";import{U as le}from"./UCCButton-IGhfY3sr.js";import{g as de,o as M,b as B,n as ce,c as ue}from"./util-BVaVe7dF.js";import{F as $}from"./consts-BpCQqH5Z.js";import"./Number-akKODsrJ.js";import"./isEqual-YuU2Zr8y.js";import"./_baseIteratee-CGcCafy9.js";import"./Dropdown-CEDZaBsM.js";import"./Clickable-vbs6x6a2.js";import"./_arrayIncludesWith-C0sUgJs0.js";import"./includes-BxfbO0I6.js";import"./Box-CA7p2Imy.js";import"./index-BQPxV8oF.js";import"./AnimationToggle-CdPY36C5.js";import"./ScrollContainerContext-DNG8B1ai.js";import"./ChevronRight-Do8a4H-E.js";import"./url-C03nQury.js";import"./Button-gbqT1swN.js";import"./ScreenReaderContent-DRRIcB0C.js";import"./ButtonSimple-uRr2gocj.js";import"./Link-ooEZC2Mq.js";import"./Divider-HUVeSv0X.js";import"./CollapsiblePanel-BAnOmC7s.js";import"./_baseDifference-BqVURxtm.js";import"./WaitSpinner-DIBk8RZx.js";import"./ExclamationTriangle-C7EecpCM.js";import"./pick-BOH874jN.js";import"./InformationCircle-kDXLS5kt.js";import"./Search-BQQL0aN1.js";import"./index-Da2o7s9M.js";import"./DotsThreeVertical-BlK1i_zF.js";import"./ChevronLeft-BwYkVmJI.js";import"./TabBar-Dvr_Y5H1.js";import"./searchUtil-DKzh7vdL.js";import"./iframe-D1ZpU7rR.js";import"./index-BAMY2Nnw.js";import"./Message-DGEUsvzS.js";import"./Modal-BXcDv01X.js";import"./ErrorBoundary-oRjb1fsE.js";import"./Heading-BHO1bh4G.js";import"./index-BbiZmkAC.js";import"./Error-BqSQnwF8.js";import"./index-DkzrWKzW.js";import"./script-ClADN3Yb.js";import"./url-uLXecbUQ.js";import"./CustomTableStyle-4srtNYm5.js";import"./index-kle9pbY7.js";import"./globalConfigMock-Daxid-vY.js";import"./ArrowBroadUnderbarDown-mTPMN3ia.js";var pe=ie();const me=P(pe);var fe=L();const ge=P(fe),_e=I(q)`
    width: 60vw;
    height: 80vh;
    margin-top: 3vh;
`,he=I(q.Header)`
    background-color: ${k.neutral50};
`,be=I(q.Footer)`
    background-color: ${k.neutral50};
    padding: 20px 40px;
`,ye=I(q.Body)`
    background-color: ${k.neutral50};
    padding-right: 30px;
    height: 70vh;
`,ve=I("div")`
    display: grid;
    grid-template-columns: 0.35fr 1fr;
    width: 100%;

    .footerBtn:first-child {
        justify-self: start;
    }

    .footerBtn:last-child {
        justify-self: end;
        margin-right: 5px;
    }
`,z=({open:l=!1,handleRequestClose:n,title:v,acceptBtnLabel:g="Done",dataIngestionDropdownValues:_,selectValueForDropdownInModal:d,setSelectValueForDropdownInModal:S,children:p})=>{const x=a.jsx(N,{label:d,style:{minWidth:"160px"},isMenu:!0}),m=[],D=e=>_.filter(s=>s.value===e)[0],w=o.useCallback(e=>_.find(s=>s.label===e),[_]),h=D(d);m.push(a.jsxs(Q.Fragment,{children:[a.jsxs(A.Item,{className:"dropdown_menu_item",children:[a.jsx(me,{style:{color:"#00A4FD",marginRight:"2px"}}),h?.label]},`selected-${h?.label}`),a.jsx(A.Divider,{},"divider")]},`selected-${h?.value}`)),_.forEach((e,s)=>{d!==e.value&&m.push(a.jsx(A.Item,{className:"dropdown_menu_item",children:e.label},`${e.label}-${s}`))});const t=o.useCallback(e=>{const s=e.target.textContent||"",c=w(s);c&&S(c.value)},[w,S]);return o.useEffect(()=>{K()},[l]),a.jsxs(_e,{returnFocus:()=>{},open:l,onRequestClose:n,children:[a.jsx(he,{title:`Data ingestion details (By ${v})`}),a.jsxs(ye,{children:[p,a.jsxs("div",{id:"data_ingestion_modal_dropdown","data-test":"data_ingestion_modal_dropdown",className:"invisible_before_moving",children:[a.jsx(ge,{id:"data_ingestion_dropdown_label","data-test":"data_ingestion_dropdown_label",children:v}),a.jsx(re,{toggle:x,children:a.jsx(A,{stopScrollPropagation:!0,style:{maxHeight:"40vh",overflow:"auto",padding:"5px 0px",margin:"10px 0px"},onClick:t,children:m})})]})]}),a.jsx(be,{children:a.jsxs(ve,{children:[a.jsx(N,{id:"open_search_on_visualization","data-test":"open_search_on_visualization",label:"View ingested events in search",openInNewContext:!0,onClick:()=>{const e=document.querySelector('#data_ingestion_modal_events_count_viz [data-test="open-search-button"]');e?e.click():document.querySelector('#data_ingestion_modal_data_volume_viz [data-test="open-search-button"]')?.click()}}),a.jsx(le,{id:"done_button_footer","data-test":"done_button_footer",className:"footerBtn",onClick:n,label:g})]})})]})};z.__docgenInfo={description:"",methods:[],displayName:"DataIngestionModal",props:{open:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},handleRequestClose:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},title:{required:!1,tsType:{name:"string"},description:""},acceptBtnLabel:{required:!1,tsType:{name:"string"},description:"",defaultValue:{value:"'Done'",computed:!1}},dataIngestionDropdownValues:{required:!0,tsType:{name:"Array",elements:[{name:"Record",elements:[{name:"string"},{name:"string"}],raw:"Record<string, string>"}],raw:"Record<string, string>[]"},description:""},selectValueForDropdownInModal:{required:!0,tsType:{name:"string"},description:""},setSelectValueForDropdownInModal:{required:!0,tsType:{name:"ReactDispatch",raw:"React.Dispatch<React.SetStateAction<string | null>>",elements:[{name:"ReactSetStateAction",raw:"React.SetStateAction<string | null>",elements:[{name:"union",raw:"string | null",elements:[{name:"string"},{name:"null"}]}]}]},description:""},children:{required:!0,tsType:{name:"ReactElement"},description:""}}};const H=({selectValueForDropdownInModal:l,selectTitleForDropdownInModal:n,setDataIngestionDropdownValues:v})=>{const g=o.useRef(null),_=o.useCallback(t=>{g.current=t},[]),[d,S]=o.useState(null),[p,x]=o.useState([]),m=o.useMemo(()=>de(),[]),D=(t,e)=>{let s=[];typeof e=="string"?s=[{label:`${e} (disabled)`,value:e}]:Array.isArray(e)&&(s=e.map(r=>({label:`${r} (disabled)`,value:r})));let c=[];return typeof t=="string"?c=[{label:t,value:t}]:Array.isArray(t)&&(c=t.map(r=>({label:r,value:r}))),[...c,...s]},w=(t,e)=>t.reduce((s,c)=>te[e]===c.field?JSON.parse(c.values).map(b=>({label:b.value,value:b.value})):s,[]),h=o.useCallback(()=>{if(!d)return null;const t=JSON.parse(JSON.stringify(d));let e=[];if(n==="Input"){const r=p[0]?.results[0]?.Active,b=p[0]?.results[0]?.event_input,C=p[0]?.results[1]?.event_input;r==="yes"?e=D(b,C):r==="no"&&(e=D(C,b))}else n==="Account"?e=w(p[1]?.results||[],n):e=w(p[2]?.results||[],n);v(e);const s=X(n,l,t.dataSources.ds_search_1.options.query),c=Z(n,l,t.dataSources.data_ingestion_modal_data_volume_ds.options.query);return t.dataSources.data_ingestion_modal_data_volume_ds.options.query=c,t.dataSources.ds_search_1.options.query=s,n==="Input"||n==="Account"?(delete t.visualizations.data_ingestion_modal_data_volume_viz,delete t.dataSources.data_ingestion_modal_data_volume_ds,delete t.layout.structure[2],t.layout.structure=t.layout.structure.filter(r=>r!==null),t.layout.structure[2].position.y=80):n==="Host"&&(delete t.visualizations.data_ingestion_modal_events_count_viz,delete t.dataSources.ds_search_1,delete t.layout.structure[3],t.layout.structure=t.layout.structure.filter(r=>r!==null)),t},[d,p,n,l,v]);return o.useEffect(()=>{(async()=>{const e=await ae(m);x(e)})()},[m]),o.useEffect(()=>{(async()=>{if(g.current&&d){const e=await h();e&&g.current?.updateDefinition(e)}})()},[d,l,h]),o.useEffect(()=>{ee("data_ingestion_modal_definition.json",S)},[]),d?a.jsx(V.DashboardContextProvider,{preset:F,featureFlags:$,children:a.jsx(T.DashboardCore,{width:"100%",height:"auto",dashboardCoreApiRef:_,actionMenus:O("data_ingestion")})}):null};H.__docgenInfo={description:`@param {object} props
@param {string} props.selectValueForDropdownInModal state for value in the modal
@param {string} props.selectTitleForDropdownInModal state for title in the modal
@param {string} props.setDataIngestionDropdownValues set state for dropdown values in modal`,methods:[],displayName:"DashboardModal",props:{selectValueForDropdownInModal:{required:!0,tsType:{name:"string"},description:""},selectTitleForDropdownInModal:{required:!0,tsType:{name:"string"},description:""},setDataIngestionDropdownValues:{required:!0,tsType:{name:"ReactDispatch",raw:"React.Dispatch<React.SetStateAction<object[]>>",elements:[{name:"ReactSetStateAction",raw:"React.SetStateAction<object[]>",elements:[{name:"Array",elements:[{name:"object"}],raw:"object[]"}]}]},description:""}}};const xe={Input:"Volume metrics are not available when the Input view is selected.",Account:"Volume metrics are not available when the Account view is selected.",Host:"Event metrics are not available when the Host view is selected."},De=M({payload:M({data:M({fields:ue(M({name:B()}))}).optional(),cellIndex:ce().optional(),value:B().optional()}).optional()}),we=({dashboardDefinition:l})=>{const n=o.useRef(null),[v,g]=o.useState(""),[_,d]=o.useState(""),[S,p]=o.useState(!1),[x,m]=o.useState(null),[D,w]=o.useState(null),[h,t]=o.useState([{}]);o.useEffect(()=>{oe();const i=document.querySelector('[data-input-id="data_ingestion_table_input"] button'),f={attributes:!0},u=E=>{E.forEach(j=>{if(j.attributeName==="data-test-value"){n.current?.updateDefinition(l),g(""),p(!1);const J=j.target?.getAttribute("label");d(J||"")}j.attributeName==="aria-expanded"&&ne(j.target)})},y=new MutationObserver(u);i&&y.observe(i,f);const R=document.querySelector('[data-input-id="data_ingestion_table_input"] button')?.getAttribute("label");return d(R||""),()=>{y&&i&&y.disconnect()}},[l]);const e=o.useCallback(i=>{n.current=i},[]),s=o.useMemo(()=>G.debounce((i,f)=>{const u=JSON.parse(JSON.stringify(l));if(u?.inputs?.data_ingestion_table_input?.options?.items?.length>0){const y=document?.querySelector('[data-input-id="data_ingestion_table_input"] button')?.getAttribute("label")||"Source type",R=u.inputs.data_ingestion_table_input.options.items.find(j=>j.label===y),E=se(i,f,R.value,y);u.dataSources.data_ingestion_table_ds.options.query=E,n.current?.updateDefinition(u)}},1e3),[l]),c=(i,{value:f})=>{g(f),s(f,S)},r=xe[_],b=o.useCallback(async i=>{const f=De.safeParse(i);if(!f.success)return;const{payload:u}=f.data;if(i.type==="datasource.done"&&i.targetId==="data_ingestion_table_ds"&&u?.data){const y=u.data?.fields[0]?.name;w(y)}i.type==="cell.click"&&i.targetId==="data_ingestion_table_viz"&&u?.cellIndex===0&&u.value&&m(u.value)},[]),C=o.useMemo(()=>({onEventTrigger:b}),[b]);return a.jsx(V.DashboardContextProvider,{preset:F,initialDefinition:l,dashboardPlugin:C,featureFlags:$,children:a.jsxs(a.Fragment,{children:[a.jsx(z,{open:!!x,handleRequestClose:()=>m(null),title:D||"",acceptBtnLabel:"Done",dataIngestionDropdownValues:h,selectValueForDropdownInModal:x||"",setSelectValueForDropdownInModal:m,children:a.jsx(Y.Panel,{label:"data_ingestion_modal",panelId:"dataIngestionModalDefTabPanel",children:a.jsx(H,{selectValueForDropdownInModal:x||"",selectTitleForDropdownInModal:D||"",setDataIngestionDropdownValues:t})})}),a.jsx(T.DashboardCore,{width:"100%",height:"auto",dashboardCoreApiRef:e,actionMenus:O("data_ingestion")}),a.jsxs("div",{id:"data_ingestion_search","data-test":"data_ingestion_search",className:"invisible_before_moving",children:[a.jsx("p",{id:"data_ingestion_search_label","data-test":"data_ingestion_search_label",children:"Search"}),a.jsx(U,{id:"data_ingestion_search_input",onChange:c,value:v,style:{minWidth:"150px",gridRow:"6",gridColumn:"1"}})]}),a.jsx("div",{id:"info_message_for_data_ingestion","data-test":"info_message_for_data_ingestion",className:"invisible_before_moving",children:r&&a.jsx(W,{appearance:"fill",type:"info",children:r})})]})})};we.__docgenInfo={description:"",methods:[],displayName:"DataIngestionDashboard",props:{dashboardDefinition:{required:!0,tsType:{name:"Record",elements:[{name:"string"},{name:"unknown"}],raw:"Record<string, unknown>"},description:""}}};export{we as DataIngestionDashboard,we as default};
